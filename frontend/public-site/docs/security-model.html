<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Loading‚Ä¶ ‚Äî Nightjar Docs</title>
  <meta name="description" content="Nightjar documentation section">
  <link rel="icon" href="/nightjar-64.png" type="image/png">
  <link rel="stylesheet" href="docs.css">
</head>
<body>

  <!-- Topbar -->
  <div class="topbar">
    <a href="/" class="topbar-brand">
      <img src="/nightjar-logo.png" alt="Nightjar">
      Nightjar Docs
    </a>
    <div class="topbar-breadcrumb" id="breadcrumb">
      <a href="/docs/">Docs</a><span class="sep">‚Ä∫</span><span id="breadcrumb-title">‚Ä¶</span>
    </div>
    <div class="topbar-links">
      <a href="/">Home</a>
      <a href="/docs/">All Docs</a>
      <a href="https://github.com/NiyaNagi/Nightjar" target="_blank" rel="noopener">GitHub</a>
    </div>
  </div>

  <div class="docs-layout">
    <nav class="docs-sidebar" id="sidebar"></nav>
    <main class="docs-content" id="content">
      <p style="color:var(--text-dim)">Loading‚Ä¶</p>
    </main>
  </div>
  <button class="mobile-sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">‚ò∞</button>

  <div class="docs-footer">
    Nightjar ¬∑ <a href="https://github.com/NiyaNagi/Nightjar" target="_blank" rel="noopener">Open Source</a> ¬∑ Built by <a href="https://github.com/NiyaNagi" target="_blank" rel="noopener">NiyaNagi</a>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js"></script>
  <script>
    mermaid.initialize({ startOnLoad: false, theme: 'dark', themeVariables: {
      primaryColor: '#6c63ff', primaryTextColor: '#e4e4e7', primaryBorderColor: '#363b4f',
      lineColor: '#6c63ff', secondaryColor: '#1a1d27', tertiaryColor: '#13151e',
      background: '#1a1d27', mainBkg: '#1a1d27', nodeBorder: '#363b4f',
      clusterBkg: '#13151e', clusterBorder: '#2a2e3d', titleColor: '#f9fafb',
      edgeLabelBackground: '#1a1d27', nodeTextColor: '#e4e4e7'
    }});

    const CONTENT_BASE = '/content';
    const SCREENSHOT_BASE = '/screenshots';

    function getSectionId() {
      const path = window.location.pathname;
      const file = path.split('/').pop() || '';
      return file.replace('.html', '');
    }

    function escapeHTML(str) {
      const el = document.createElement('span');
      el.textContent = str;
      return el.innerHTML;
    }

    function renderBlock(block) {
      switch (block.type) {
        case 'heading':
          return `<h3>${escapeHTML(block.text)}</h3>`;
        case 'paragraph':
          return `<p>${escapeHTML(block.text)}</p>`;
        case 'list':
          return `<ul>${(block.items || []).map(i => `<li>${escapeHTML(i)}</li>`).join('')}</ul>`;
        case 'steps':
          return `<ol>${(block.items || []).map(i => `<li>${escapeHTML(i)}</li>`).join('')}</ol>`;
        case 'tip':
          return `<div class="tip-box"><span class="icon">üí°</span><p>${escapeHTML(block.text)}</p></div>`;
        case 'warning':
          return `<div class="warning-box"><span class="icon">‚ö†Ô∏è</span><p>${escapeHTML(block.text)}</p></div>`;
        case 'shortcuts':
          return `<div class="shortcuts-table">${(block.items || []).map(item =>
            `<div class="shortcut-row">
              <span class="shortcut-keys">${item.keys.map((k, i) =>
                `${i > 0 ? '<span class="plus">+</span>' : ''}<kbd>${escapeHTML(k)}</kbd>`
              ).join('')}</span>
              <span class="shortcut-action">${escapeHTML(item.action)}</span>
            </div>`
          ).join('')}</div>`;
        case 'screenshot':
          return `<figure class="doc-screenshot">
            <img src="${SCREENSHOT_BASE}/${escapeHTML(block.id)}.webp"
                 alt="${escapeHTML(block.caption || block.id)}"
                 loading="lazy"
                 onerror="this.parentElement.style.display='none'">
            ${block.caption ? `<figcaption>${escapeHTML(block.caption)}</figcaption>` : ''}
          </figure>`;
        case 'code':
          const codeId = 'code-' + Math.random().toString(36).slice(2, 8);
          return `<div class="code-block">
            ${block.lang ? `<div class="code-block-header"><span class="code-block-lang">${escapeHTML(block.lang)}</span><button class="code-block-copy" onclick="navigator.clipboard.writeText(document.getElementById('${codeId}').textContent).then(()=>{this.textContent='Copied!';setTimeout(()=>this.textContent='Copy',1500)})">Copy</button></div>` : ''}
            <pre><code id="${codeId}">${escapeHTML(block.text)}</code></pre>
            ${block.caption ? `<div class="code-block-caption">${escapeHTML(block.caption)}</div>` : ''}
          </div>`;
        case 'mermaid':
          const mermaidId = 'mermaid-' + Math.random().toString(36).slice(2, 8);
          return `<div class="mermaid-block">
            ${block.caption ? `<div class="mermaid-block-header">${escapeHTML(block.caption)}</div>` : ''}
            <div class="mermaid" id="${mermaidId}">${escapeHTML(block.text)}</div>
          </div>`;
        default:
          return '';
      }
    }

    async function init() {
      const sectionId = getSectionId();
      if (!sectionId) { window.location.href = '/docs/'; return; }

      let sections = [];
      try {
        const idxRes = await fetch(`${CONTENT_BASE}/index.json`);
        if (idxRes.ok) {
          const idx = await idxRes.json();
          sections = idx.sections || [];
        }
      } catch {}

      // Build sidebar with search
      const sidebar = document.getElementById('sidebar');
      sidebar.innerHTML = '<div class="sidebar-search"><svg class="search-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg><input type="text" placeholder="Search docs‚Ä¶" id="sidebar-search" aria-label="Search documentation"></div><h3>Documentation</h3><ul id="sidebar-list">' +
        sections.map(s => {
          const active = s.id === sectionId ? ' class="active"' : '';
          const label = s.title;
          return `<li data-title="${escapeHTML(label.toLowerCase())}" data-summary="${escapeHTML((s.summary || '').toLowerCase())}"><a href="${s.id}.html"${active}><span class="icon">${s.icon}</span><span class="sidebar-label">${escapeHTML(label)}</span></a></li>`;
        }).join('') + '</ul>';

      // Search filter
      const searchInput = document.getElementById('sidebar-search');
      searchInput.addEventListener('input', () => {
        const q = searchInput.value.toLowerCase().trim();
        document.querySelectorAll('#sidebar-list li').forEach(li => {
          const match = !q || li.dataset.title.includes(q) || li.dataset.summary.includes(q);
          li.style.display = match ? '' : 'none';
        });
      });

      // Mobile sidebar toggle
      const sidebarToggle = document.getElementById('sidebar-toggle');
      if (sidebarToggle) {
        sidebarToggle.addEventListener('click', () => {
          const isOpen = sidebar.classList.toggle('open');
          sidebarToggle.textContent = isOpen ? '‚úï' : '‚ò∞';
        });
      }

      // Load section content
      let data;
      try {
        const res = await fetch(`${CONTENT_BASE}/${sectionId}.json`);
        if (!res.ok) { window.location.href = '/docs/'; return; }
        data = await res.json();
      } catch {
        window.location.href = '/docs/';
        return;
      }

      document.title = `${data.title} ‚Äî Nightjar Docs`;
      document.getElementById('breadcrumb-title').textContent = data.title;

      const content = document.getElementById('content');
      let html = `<h1>${escapeHTML(data.title)}</h1>`;
      html += (data.content || []).map(renderBlock).join('\n');

      const idx = sections.findIndex(s => s.id === sectionId);
      if (idx !== -1) {
        const prev = idx > 0 ? sections[idx - 1] : null;
        const next = idx < sections.length - 1 ? sections[idx + 1] : null;
        html += '<div class="docs-nav">';
        if (prev) {
          html += `<a href="${prev.id}.html"><span class="label">‚Üê Previous</span><span class="title">${escapeHTML(prev.title)}</span></a>`;
        }
        if (next) {
          html += `<a href="${next.id}.html" class="next"><span class="label">Next ‚Üí</span><span class="title">${escapeHTML(next.title)}</span></a>`;
        }
        html += '</div>';
      }

      content.innerHTML = html;

      // Render mermaid diagrams
      try { await mermaid.run({ querySelector: '.mermaid' }); } catch {}
    }
    init();
  </script>
</body>
</html>
