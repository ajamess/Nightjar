/**
 * Sheet Component Styles
 * Minimal styles for the Fortune Sheet spreadsheet wrapper.
 * 
 * IMPORTANT: Fortune Sheet uses a light theme internally. We must isolate
 * it from the app's dark mode by explicitly setting light mode colors
 * on the container. This prevents CSS inheritance from breaking the
 * spreadsheet's native styling.
 */

/* Container fills available space and isolates from app theme */
.sheet-container {
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    position: relative;
    /* Isolate from dark mode - Fortune Sheet expects light theme */
    background: #ffffff;
    color: #333333;
    /* Reset any inherited font/color */
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    
    /* Override CSS variables with light theme values for Fortune Sheet */
    --text-primary: #333333;
    --text-secondary: #666666;
    --bg-primary: #ffffff;
    --bg-secondary: #f5f5f5;
}

.sheet-workbook-wrapper {
    flex: 1;
    position: relative;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    min-height: 0;
    /* Ensure wrapper also has light background */
    background: #ffffff;
    color: #333333;
}

/*
 * Reset box-sizing for Fortune Sheet elements.
 * The global CSS uses border-box, but Fortune Sheet's internal
 * positioning calculations expect content-box sizing.
 * Apply to the main fortune-container and all its children.
 */
.sheet-workbook-wrapper .fortune-container,
.sheet-workbook-wrapper .fortune-container *,
.sheet-workbook-wrapper .fortune-container *::before,
.sheet-workbook-wrapper .fortune-container *::after {
    box-sizing: content-box !important;
}

/* 
 * EXCEPTION: Keep toolbar and formula bar elements with border-box sizing.
 * These layouts use flexbox and need border-box for proper borders.
 */
.sheet-workbook-wrapper .fortune-toolbar,
.sheet-workbook-wrapper .fortune-toolbar *,
.sheet-workbook-wrapper .fortune-toolbar *::before,
.sheet-workbook-wrapper .fortune-toolbar *::after,
.sheet-workbook-wrapper .fortune-toolbar-combo-popup,
.sheet-workbook-wrapper .fortune-toolbar-combo-popup *,
.sheet-workbook-wrapper .fortune-fx-editor,
.sheet-workbook-wrapper .fortune-fx-editor *,
.sheet-workbook-wrapper .fortune-name-box-container,
.sheet-workbook-wrapper .fortune-name-box-container *,
.sheet-workbook-wrapper .fortune-fx-icon,
.sheet-workbook-wrapper .fortune-fx-icon *,
.sheet-workbook-wrapper .fortune-fx-input-container,
.sheet-workbook-wrapper .fortune-fx-input-container * {
    box-sizing: border-box !important;
}

/*
 * Fortune Sheet Toolbar Fixes
 * Ensure toolbar elements are visible and use correct light theme colors
 * Using CORRECT Fortune Sheet class names
 */

/* Toolbar container */
.sheet-container .fortune-toolbar {
    background: #fafafc !important;
    color: #333333 !important;
    border-bottom: 1px solid #d4d4d4 !important;
}

/* Toolbar buttons and combos - ensure visibility */
.sheet-container .fortune-toolbar-button,
.sheet-container .fortune-toolbar-combo {
    color: #333333 !important;
    background: transparent !important;
}

.sheet-container .fortune-toolbar-button:hover,
.sheet-container .fortune-toolbar-combo:hover {
    background: rgba(0, 0, 0, 0.06) !important;
}

/* SVG icons inside toolbar - CRITICAL for visibility */
.sheet-container .fortune-toolbar svg,
.sheet-container .fortune-toolbar svg use,
.sheet-container .fortune-toolbar-button svg,
.sheet-container .fortune-toolbar-button svg use {
    fill: #535A68 !important;
    color: #535A68 !important;
}

/* Toolbar overflow popup (more button menu) */
.sheet-container .fortune-toolbar-more-container {
    background: #ffffff !important;
    border: 1px solid #e0e0e0 !important;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15) !important;
}

.sheet-container .fortune-toolbar-more-container .fortune-toolbar-button,
.sheet-container .fortune-toolbar-more-container .fortune-toolbar-combo {
    color: #333333 !important;
    background: transparent !important;
}

.sheet-container .fortune-toolbar-more-container .fortune-toolbar-button:hover,
.sheet-container .fortune-toolbar-more-container .fortune-toolbar-combo:hover {
    background: rgba(0, 0, 0, 0.06) !important;
}

/* SVG icons in overflow popup - CRITICAL for visibility */
.sheet-container .fortune-toolbar-more-container svg,
.sheet-container .fortune-toolbar-more-container svg use {
    fill: #535A68 !important;
    color: #535A68 !important;
}

/* Combo dropdown text */
.sheet-container .fortune-toolbar-combo-text {
    color: #333333 !important;
}

/* Toolbar combo arrow */
.sheet-container .fortune-toolbar-combo-arrow svg {
    fill: #666666 !important;
}

/* Toolbar popup menus */
.sheet-container .fortune-toolbar-combo-popup {
    background: #ffffff !important;
    color: #333333 !important;
    border: 1px solid #e0e0e0 !important;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15) !important;
}

/* Select options in toolbar */
.sheet-container .fortune-toolbar-select-option {
    color: #333333 !important;
    background: #ffffff !important;
}

.sheet-container .fortune-toolbar-select-option:hover {
    background: #f0f0f0 !important;
}

/* Formula bar - with visible borders */
.sheet-container .fortune-fx-editor,
.sheet-workbook-wrapper .fortune-fx-editor {
    display: flex !important;
    align-items: center !important;
    background: #ffffff !important;
    border-bottom: 1px solid #c0c0c0 !important;
    min-height: 28px !important;
    box-sizing: border-box !important;
}

.sheet-container .fortune-name-box-container,
.sheet-workbook-wrapper .fortune-name-box-container {
    display: flex !important;
    align-items: center !important;
    border-right: 1px solid #c0c0c0 !important;
    background: #ffffff !important;
    min-height: 100% !important;
    box-sizing: border-box !important;
}

.sheet-container .fortune-name-box,
.sheet-workbook-wrapper .fortune-name-box {
    background: #ffffff !important;
    color: #333333 !important;
    min-width: 60px !important;
    padding: 4px 8px !important;
    box-sizing: border-box !important;
}

.sheet-container .fortune-fx-icon,
.sheet-workbook-wrapper .fortune-fx-icon {
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    padding: 0 8px !important;
    border-right: 1px solid #c0c0c0 !important;
    background: #fafafc !important;
    min-height: 100% !important;
    box-sizing: border-box !important;
}

.sheet-container .fortune-fx-icon svg,
.sheet-workbook-wrapper .fortune-fx-icon svg {
    fill: #535A68 !important;
}

.sheet-container .fortune-fx-input-container,
.sheet-workbook-wrapper .fortune-fx-input-container {
    flex: 1 !important;
    display: flex !important;
    align-items: center !important;
    background: #ffffff !important;
    min-height: 100% !important;
    border-left: 1px solid #c0c0c0 !important;
    box-sizing: border-box !important;
}

.sheet-container .fortune-fx-input,
.sheet-workbook-wrapper .fortune-fx-input {
    background: #ffffff !important;
    color: #333333 !important;
    flex: 1 !important;
    min-height: 24px !important;
    padding: 4px 8px !important;
    box-sizing: border-box !important;
}

.sheet-container .fortune-formula-bar,
.sheet-workbook-wrapper .fortune-formula-bar {
    background: #ffffff !important;
    color: #333333 !important;
    border-bottom: 1px solid #c0c0c0 !important;
}

/* Sheet tabs */
.sheet-container .fortune-sheet-tab {
    background: #f5f5f5 !important;
    color: #333333 !important;
    border: 1px solid #e0e0e0 !important;
}

.sheet-container .fortune-sheet-tab:hover {
    background: #e0e0e0 !important;
}

/* Context menu */
.sheet-container .fortune-context-menu {
    background: #ffffff !important;
    color: #333333 !important;
    border: 1px solid #e0e0e0 !important;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15) !important;
}

.sheet-container .fortune-context-menu-item {
    color: #333333 !important;
}

.sheet-container .fortune-context-menu-item:hover {
    background: #f0f0f0 !important;
}

/* Readonly banner */
.sheet-readonly-banner {
    background: #fef3cd;
    color: #856404;
    padding: 8px 16px;
    font-size: 14px;
    text-align: center;
    flex-shrink: 0;
}

/* Loading state */
.sheet-loading {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100%;
    font-size: 18px;
    color: var(--text-secondary, #666);
}

/* Ensure scrollbars are above chat bubble */
.sheet-container .luckysheet-scrollbar-y,
.sheet-container .luckysheet-scrollbar-x {
    z-index: 100 !important;
}

/* Readonly mode overlay */
.sheet-container--readonly {
    position: relative;
}

/* Fortune Sheet presence/collaboration overlays - fix positioning and visibility */
/* Target the presence container to ensure it can overflow cell boundaries */
.sheet-container .luckysheet-cell-presence,
.sheet-container [class*="presence"] {
    overflow: visible !important;
}

/* Username label styling - ensure high contrast and visibility */
.sheet-container .fortune-presence-username,
.sheet-container [class*="presence-username"],
.sheet-container [class*="collaborator-name"] {
    /* Position in upper-right corner of the cell */
    position: absolute !important;
    top: 0 !important;
    right: 0 !important;
    left: auto !important;
    transform: none !important;
    border-radius: 0 0 0 4px !important;
    font-size: 11px !important;
    font-weight: 600 !important;
    padding: 3px 8px !important;
    /* High contrast styling - solid background with white text */
    background-color: inherit !important; /* Will use the user's color */
    color: white !important;
    text-shadow: 0 1px 1px rgba(0, 0, 0, 0.3) !important;
    /* Ensure text is fully visible */
    min-width: fit-content !important;
    max-width: none !important;
    width: auto !important;
    overflow: visible !important;
    white-space: nowrap !important;
    text-overflow: clip !important;
    z-index: 50 !important;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.25) !important;
}

/* Selection border styling */
.sheet-container .fortune-presence-selection,
.sheet-container [class*="presence-selection"] {
    z-index: 49 !important;
    pointer-events: none !important;
}

/* Ensure presence overlays don't appear over modals */
.sheet-workbook-wrapper {
    isolation: isolate; /* Create stacking context */
}

/* Custom presence dot overlays (replaces unreliable Fortune Sheet presence API) */
.sheet-presence-border {
    z-index: 99;
    pointer-events: none;
    border-radius: 2px;
}

.sheet-presence-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    z-index: 100;
    pointer-events: auto;
    cursor: pointer;
    transition: all 0.15s ease;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
    border: 2px solid white;
}

.sheet-presence-dot:hover {
    width: auto;
    height: auto;
    border-radius: 12px;
    padding: 2px 8px;
}

.sheet-presence-name {
    display: none;
    font-size: 11px;
    font-weight: 600;
    color: white;
    white-space: nowrap;
    text-shadow: 0 1px 1px rgba(0, 0, 0, 0.3);
}

.sheet-presence-dot:hover .sheet-presence-name {
    display: inline;
}

/* ── Mobile ── */
@media (max-width: 768px) {
  .sheet-readonly-banner {
    padding: 6px 10px;
    font-size: 12px;
  }
  .sheet-container .fortune-toolbar {
    overflow-x: auto !important;
    -webkit-overflow-scrolling: touch;
    flex-wrap: nowrap !important;
  }
  .sheet-container .fortune-name-box {
    min-width: 40px !important;
  }
}
